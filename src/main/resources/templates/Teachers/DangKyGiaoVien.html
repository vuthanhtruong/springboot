<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Đăng Ký Giáo Viên</title>
    <link href="/DangKyGiaoVien.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="d-flex align-items-center justify-content-center vh-100 bg-light">
<main class="container">
    <div class="row justify-content-center">
        <section class="col-md-6">
            <div class="card shadow-lg p-4">
                <h1 class="text-center mb-4">Đăng Ký Giáo Viên</h1>
                <div class="alert alert-danger text-center" role="alert" th:if="${databaseError}"
                     th:text="${databaseError}"></div>
                <form method="POST" th:action="@{/DangKyGiaoVien}">
                    <div class="mb-3">
                        <label class="form-label" for="teacherID">ID Giáo Viên</label>
                        <input class="form-control" id="teacherID" name="TeacherID" required type="text">
                        <div class="text-danger" th:if="${teacherIDError}" th:text="${teacherIDError}"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="firstName">Họ</label>
                        <input class="form-control" id="firstName" name="FirstName" required type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="lastName">Tên</label>
                        <input class="form-control" id="lastName" name="LastName" required type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="email">Email</label>
                        <input class="form-control" id="email" name="Email" required type="email">
                        <div class="text-danger" th:if="${emailError}" th:text="${emailError}"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="phoneNumber">Số Điện Thoại</label>
                        <input class="form-control" id="phoneNumber" name="PhoneNumber" required type="text">
                        <div class="text-danger" th:if="${phoneError}" th:text="${phoneError}"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="birthDate">Ngày Sinh</label>
                        <input class="form-control" id="birthDate" name="BirthDate" required type="date">
                        <div class="text-danger" th:if="${birthDateError}" th:text="${birthDateError}"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="gender">Giới Tính</label>
                        <select class="form-control" id="gender" name="Gender" required>
                            <option value="MALE">Nam</option>
                            <option value="FEMALE">Nữ</option>
                            <option value="OTHER">Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="country">Quốc Gia</label>
                        <select class="form-control" id="country" name="Country" required>
                            <option value="">Chọn quốc gia</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="province">Tỉnh/Thành phố</label>
                        <select class="form-control" id="province" name="Province">
                            <option value="">Chọn tỉnh/thành phố</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="district">Quận/Huyện</label>
                        <select class="form-control" id="district" name="District">
                            <option value="">Chọn quận/huyện</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="ward">Xã/Phường</label>
                        <select class="form-control" id="ward" name="Ward">
                            <option value="">Chọn xã/phường</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="street">Đường, Số Nhà</label>
                        <input class="form-control" id="street" name="Street" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="postalCode">Mã Bưu Điện</label>
                        <input class="form-control" id="postalCode" name="PostalCode" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="misID">(MIS ID - nếu có)</label>
                        <input class="form-control" id="misID" name="MisID" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="password">Mật Khẩu</label>
                        <input class="form-control" id="password" name="Password" required type="password">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="confirmPassword">Xác Nhận Mật Khẩu</label>
                        <input class="form-control" id="confirmPassword" name="ConfirmPassword" required
                               type="password">
                        <div class="text-danger" th:if="${passwordError}" th:text="${passwordError}"></div>
                    </div>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" type="submit">Đăng Ký</button>
                        <a class="btn btn-outline-secondary" href="/TrangChu">Quay Lại Đăng Nhập</a>
                    </div>
                </form>
            </div>
        </section>
    </div>
</main>
<script>
    const countrySelect = document.getElementById("country");
    const provinceSelect = document.getElementById("province");
    const districtSelect = document.getElementById("district");
    const wardSelect = document.getElementById("ward");

    // Tải danh sách quốc gia từ Rest Countries API
    axios.get("https://restcountries.com/v3.1/all")
        .then(response => {
            const countries = response.data.sort((a, b) => a.name.common.localeCompare(b.name.common));
            countries.forEach(country => {
                const option = document.createElement("option");
                option.value = country.cca2;
                option.textContent = country.name.common;
                countrySelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error("Lỗi tải quốc gia:", error);
            countrySelect.innerHTML = '<option value="">Không thể tải quốc gia</option>';
        });

    // Tải danh sách tỉnh/thành phố khi chọn quốc gia
    countrySelect.addEventListener("change", function () {
        const countryCode = this.value;
        provinceSelect.innerHTML = '<option value="">Chọn tỉnh/thành phố</option>';
        districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (countryCode) {
            const geonameId = getCountryGeonameId(countryCode);
            if (!geonameId) {
                provinceSelect.innerHTML = '<option value="">Quốc gia này chưa được hỗ trợ</option>';
                return;
            }

            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${geonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const provinces = response.data.geonames || [];
                    if (!provinces || provinces.length === 0) {
                        provinceSelect.innerHTML = '<option value="">Không có dữ liệu tỉnh/thành phố</option>';
                    } else {
                        provinces.forEach(province => {
                            const option = document.createElement("option");
                            option.value = province.name;
                            option.textContent = province.name;
                            option.dataset.geonameId = province.geonameId;
                            provinceSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải tỉnh/thành phố:", errorMessage);
                    provinceSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Tải danh sách quận/huyện khi chọn tỉnh/thành phố
    provinceSelect.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const provinceGeonameId = selectedOption ? selectedOption.dataset.geonameId : null;
        districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (provinceGeonameId) {
            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${provinceGeonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const districts = response.data.geonames || [];
                    if (!districts || districts.length === 0) {
                        districtSelect.innerHTML = '<option value="">Không có dữ liệu quận/huyện</option>';
                    } else {
                        districts.forEach(district => {
                            const option = document.createElement("option");
                            option.value = district.name;
                            option.textContent = district.name;
                            option.dataset.geonameId = district.geonameId;
                            districtSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải quận/huyện:", errorMessage);
                    districtSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Tải danh sách xã/phường khi chọn quận/huyện
    districtSelect.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const districtGeonameId = selectedOption ? selectedOption.dataset.geonameId : null;
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (districtGeonameId) {
            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${districtGeonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const wards = response.data.geonames || [];
                    if (!wards || wards.length === 0) {
                        wardSelect.innerHTML = '<option value="">Không có dữ liệu xã/phường</option>';
                    } else {
                        wards.forEach(ward => {
                            const option = document.createElement("option");
                            option.value = ward.name;
                            option.textContent = ward.name;
                            wardSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải xã/phường:", errorMessage);
                    wardSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Hàm lấy geonameId của quốc gia
    function getCountryGeonameId(countryCode) {
        const countryIds = {
            "AF": 1149361, // Afghanistan
            "AL": 783754, // Albania
            "DZ": 2589581, // Algeria
            "AD": 3041565, // Andorra
            "AO": 3351879, // Angola
            "AG": 3576396, // Antigua and Barbuda
            "AR": 3865483, // Argentina
            "AM": 174982, // Armenia
            "AU": 2077456, // Australia
            "AT": 2782113, // Austria
            "AZ": 587116, // Azerbaijan
            "BS": 3572887, // Bahamas
            "BH": 290291, // Bahrain
            "BD": 1210997, // Bangladesh
            "BB": 3374084, // Barbados
            "BY": 630336, // Belarus
            "BE": 2802361, // Belgium
            "BZ": 3582678, // Belize
            "BJ": 2395170, // Benin
            "BT": 1252634, // Bhutan
            "BO": 3923057, // Bolivia
            "BA": 3277605, // Bosnia and Herzegovina
            "BW": 933860, // Botswana
            "BR": 3469034, // Brazil
            "BN": 1820814, // Brunei
            "BG": 732800, // Bulgaria
            "BF": 2361809, // Burkina Faso
            "BI": 433561, // Burundi
            "KH": 1831722, // Cambodia
            "CM": 2233387, // Cameroon
            "CA": 6251999, // Canada
            "CV": 3374766, // Cape Verde
            "CF": 239880, // Central African Republic
            "TD": 2434508, // Chad
            "CL": 3895114, // Chile
            "CN": 1814991, // China
            "CO": 3686110, // Colombia
            "KM": 921929, // Comoros
            "CD": 203312, // Congo (Democratic Republic)
            "CG": 2260494, // Congo (Republic)
            "CR": 3624060, // Costa Rica
            "HR": 3202326, // Croatia
            "CU": 3562981, // Cuba
            "CY": 146669, // Cyprus
            "CZ": 3077311, // Czechia
            "DK": 2623032, // Denmark
            "DJ": 223816, // Djibouti
            "DO": 3508796, // Dominican Republic
            "EC": 3658394, // Ecuador
            "EG": 357994, // Egypt
            "SV": 3585968, // El Salvador
            "GQ": 2309096, // Equatorial Guinea
            "ER": 338010, // Eritrea
            "EE": 453733, // Estonia
            "ET": 337996, // Ethiopia
            "FJ": 2205218, // Fiji
            "FI": 660013, // Finland
            "FR": 3017382, // France
            "GA": 2400553, // Gabon
            "GM": 2413451, // Gambia
            "GE": 614540, // Georgia
            "DE": 2921044, // Germany
            "GH": 2300660, // Ghana
            "GR": 390903, // Greece
            "GT": 3595528, // Guatemala
            "GN": 2420477, // Guinea
            "GY": 3378535, // Guyana
            "HT": 3723988, // Haiti
            "HN": 3608932, // Honduras
            "HU": 719819, // Hungary
            "IS": 2629691, // Iceland
            "IN": 1269750, // India
            "ID": 1643084, // Indonesia
            "IR": 130758, // Iran
            "IQ": 99237, // Iraq
            "IE": 2963597, // Ireland
            "IT": 3175395, // Italy
            "JP": 1861060, // Japan
            "JO": 248816, // Jordan
            "KZ": 1522867, // Kazakhstan
            "KE": 192950, // Kenya
            "KR": 1835841, // South Korea
            "KW": 285570, // Kuwait
            "KG": 1527747, // Kyrgyzstan
            "LA": 1655842, // Laos
            "LV": 458258, // Latvia
            "LB": 272103, // Lebanon
            "LY": 2215636, // Libya
            "LT": 597427, // Lithuania
            "LU": 2960313, // Luxembourg
            "MG": 1062947, // Madagascar
            "MW": 927384, // Malawi
            "MY": 1733045, // Malaysia
            "MV": 1282028, // Maldives
            "ML": 2453866, // Mali
            "MT": 2562770, // Malta
            "MX": 3996063, // Mexico
            "MD": 617790, // Moldova
            "MC": 2993457, // Monaco
            "MN": 2029969, // Mongolia
            "MA": 2542007, // Morocco
            "MZ": 1036973, // Mozambique
            "MM": 1327865, // Myanmar
            "NA": 3355338, // Namibia
            "NP": 1282988, // Nepal
            "NL": 2750405, // Netherlands
            "NZ": 2186224, // New Zealand
            "NG": 2328926, // Nigeria
            "NO": 3144096, // Norway
            "OM": 286963, // Oman
            "PK": 1168579, // Pakistan
            "PA": 3703430, // Panama
            "PY": 3437598, // Paraguay
            "PE": 3932488, // Peru
            "PH": 1694008, // Philippines
            "PL": 798544, // Poland
            "PT": 2264397, // Portugal
            "QA": 289688, // Qatar
            "RO": 798549, // Romania
            "RU": 2017370, // Russia
            "SA": 102358, // Saudi Arabia
            "SG": 1880251, // Singapore
            "ZA": 953987, // South Africa
            "ES": 2510769, // Spain
            "SE": 2661886, // Sweden
            "CH": 2658434, // Switzerland
            "TH": 1605651, // Thailand
            "TR": 298795, // Turkey
            "UA": 690791, // Ukraine
            "AE": 290557, // United Arab Emirates
            "GB": 2635167, // United Kingdom
            "US": 6252001, // United States
            "VN": 1562822, // Vietnam
            "ZW": 878675  // Zimbabwe
        };

        return countryIds[countryCode] || null;
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>