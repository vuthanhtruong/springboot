<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Đăng Ký Nhân Viên</title>
    <link href="/DangKyNhanVien.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="d-flex align-items-center justify-content-center vh-100 bg-light">
<main class="container">
    <div class="row justify-content-center">
        <section class="col-md-6">
            <div class="card shadow-lg p-4">
                <h1 class="text-center mb-4">Đăng Ký Nhân Viên</h1>

                <form method="POST" th:action="@{/DangKyNhanVien}">
                    <!-- Mã Nhân viên -->
                    <div class="mb-3">
                        <label class="form-label" for="employeeID">Mã Nhân Viên</label>
                        <input class="form-control" id="employeeID" name="EmployeeID" required type="text">
                        <div class="text-danger" th:if="${employeeIDError}" th:text="${employeeIDError}"></div>
                    </div>

                    <!-- Họ -->
                    <div class="mb-3">
                        <label class="form-label" for="firstName">Họ</label>
                        <input class="form-control" id="firstName" name="FirstName" required type="text">
                    </div>

                    <!-- Tên -->
                    <div class="mb-3">
                        <label class="form-label" for="lastName">Tên</label>
                        <input class="form-control" id="lastName" name="LastName" required type="text">
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label class="form-label" for="email">Email</label>
                        <input class="form-control" id="email" name="Email" required type="email">
                        <div class="text-danger" th:if="${emailFormatError}" th:text="${emailFormatError}"></div>
                        <div class="text-danger" th:if="${emailError}" th:text="${emailError}"></div>
                    </div>

                    <!-- Ngày sinh -->
                    <div class="mb-3">
                        <label class="form-label" for="dateOfBirth">Ngày Sinh</label>
                        <input class="form-control" id="dateOfBirth" name="DateOfBirth" required type="date">
                        <div class="text-danger" th:if="${dobError}" th:text="${dobError}"></div>
                    </div>
                    <!-- Giới tính -->
                    <div class="mb-3">
                        <label class="form-label" for="gender">Giới Tính</label>
                        <select class="form-control" id="gender" name="Gender" required>
                            <option value="MALE">Nam</option>
                            <option value="FEMALE">Nữ</option>
                            <option value="OTHER">Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="country">Quốc Gia</label>
                        <select class="form-control" id="country" name="Country" required>
                            <option value="">Chọn quốc gia</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="province">Tỉnh/Thành phố</label>
                        <select class="form-control" id="province" name="Province">
                            <option value="">Chọn tỉnh/thành phố</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="district">Quận/Huyện</label>
                        <select class="form-control" id="district" name="District">
                            <option value="">Chọn quận/huyện</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="ward">Xã/Phường</label>
                        <select class="form-control" id="ward" name="Ward">
                            <option value="">Chọn xã/phường</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="street">Đường, Số Nhà</label>
                        <input class="form-control" id="street" name="Street" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="postalCode">Mã Bưu Điện</label>
                        <input class="form-control" id="postalCode" name="PostalCode" type="text">
                    </div>

                    <!-- Số điện thoại -->
                    <div class="mb-3">
                        <label class="form-label" for="phoneNumber">Số Điện Thoại</label>
                        <input class="form-control" id="phoneNumber" name="PhoneNumber" required type="text">
                        <div class="text-danger" th:if="${phoneError}" th:text="${phoneError}"></div>
                        <div class="text-danger" th:if="${phoneDuplicateError}" th:text="${phoneDuplicateError}"></div>
                    </div>

                    <!-- Mật khẩu -->
                    <div class="mb-3">
                        <label class="form-label" for="password">Mật Khẩu</label>
                        <input class="form-control" id="password" name="Password" required type="password">
                        <div class="text-danger" th:if="${passwordStrengthError}"
                             th:text="${passwordStrengthError}"></div>
                    </div>

                    <!-- Xác nhận mật khẩu -->
                    <div class="mb-3">
                        <label class="form-label" for="confirmPassword">Xác Nhận Mật Khẩu</label>
                        <input class="form-control" id="confirmPassword" name="ConfirmPassword" required
                               type="password">
                        <div class="text-danger" th:if="${passwordError}" th:text="${passwordError}"></div>
                    </div>

                    <!-- Nút Đăng ký & Quay lại -->
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" type="submit">Đăng Ký</button>
                        <a class="btn btn-outline-secondary" href="/TrangChu">Quay Lại Đăng Nhập</a>
                    </div>
                </form>
            </div>
        </section>
    </div>
</main>
<script>
    const countrySelect = document.getElementById("country");
    const provinceSelect = document.getElementById("province");
    const districtSelect = document.getElementById("district");
    const wardSelect = document.getElementById("ward");

    // Tải danh sách quốc gia từ Rest Countries API
    axios.get("https://restcountries.com/v3.1/all")
        .then(response => {
            const countries = response.data.sort((a, b) => a.name.common.localeCompare(b.name.common));
            countries.forEach(country => {
                const option = document.createElement("option");
                option.value = country.cca2;
                option.textContent = country.name.common;
                countrySelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error("Lỗi tải quốc gia:", error);
            countrySelect.innerHTML = '<option value="">Không thể tải quốc gia</option>';
        });

    // Tải danh sách tỉnh/thành phố khi chọn quốc gia
    countrySelect.addEventListener("change", function () {
        const countryCode = this.value;
        provinceSelect.innerHTML = '<option value="">Chọn tỉnh/thành phố</option>';
        districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (countryCode) {
            const geonameId = getCountryGeonameId(countryCode);
            if (!geonameId) {
                provinceSelect.innerHTML = '<option value="">Quốc gia này chưa được hỗ trợ</option>';
                return;
            }

            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${geonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const provinces = response.data.geonames || [];
                    if (!provinces || provinces.length === 0) {
                        provinceSelect.innerHTML = '<option value="">Không có dữ liệu tỉnh/thành phố</option>';
                    } else {
                        provinces.forEach(province => {
                            const option = document.createElement("option");
                            option.value = province.name;
                            option.textContent = province.name;
                            option.dataset.geonameId = province.geonameId;
                            provinceSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải tỉnh/thành phố:", errorMessage);
                    provinceSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Tải danh sách quận/huyện khi chọn tỉnh/thành phố
    provinceSelect.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const provinceGeonameId = selectedOption ? selectedOption.dataset.geonameId : null;
        districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (provinceGeonameId) {
            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${provinceGeonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const districts = response.data.geonames || [];
                    if (!districts || districts.length === 0) {
                        districtSelect.innerHTML = '<option value="">Không có dữ liệu quận/huyện</option>';
                    } else {
                        districts.forEach(district => {
                            const option = document.createElement("option");
                            option.value = district.name;
                            option.textContent = district.name;
                            option.dataset.geonameId = district.geonameId;
                            districtSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải quận/huyện:", errorMessage);
                    districtSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Tải danh sách xã/phường khi chọn quận/huyện
    districtSelect.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const districtGeonameId = selectedOption ? selectedOption.dataset.geonameId : null;
        wardSelect.innerHTML = '<option value="">Chọn xã/phường</option>';

        if (districtGeonameId) {
            const geoNamesUsername = "myusername"; // Thay bằng username GeoNames của bạn
            const url = `http://api.geonames.org/childrenJSON?geonameId=${districtGeonameId}&username=${geoNamesUsername}`;
            console.log("Gửi yêu cầu tới:", url);

            axios.get(url)
                .then(response => {
                    console.log("Dữ liệu trả về:", response.data);
                    const wards = response.data.geonames || [];
                    if (!wards || wards.length === 0) {
                        wardSelect.innerHTML = '<option value="">Không có dữ liệu xã/phường</option>';
                    } else {
                        wards.forEach(ward => {
                            const option = document.createElement("option");
                            option.value = ward.name;
                            option.textContent = ward.name;
                            wardSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    const errorMessage = error.response
                        ? (error.response.data.status ? error.response.data.status.message : error.response.data)
                        : error.message;
                    console.error("Lỗi tải xã/phường:", errorMessage);
                    wardSelect.innerHTML = `<option value="">Lỗi: ${errorMessage}</option>`;
                });
        }
    });

    // Hàm lấy geonameId của quốc gia
    function getCountryGeonameId(countryCode) {
        const countryIds = {
            "VN": 1562822, // Việt Nam
            "US": 6252001, // Hoa Kỳ
            "JP": 1861060, // Nhật Bản
            "CN": 1814991, // Trung Quốc
            "FR": 3017382  // Pháp
        };
        return countryIds[countryCode] || null;
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Bootstrap JS (tùy chọn, nếu cần tính năng động) -->
<script crossorigin="anonymous"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>